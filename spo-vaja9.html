<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPO Vaja 9 - TCP StreÅ¾nik in Odjemalec</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-card: #151933;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --accent-purple: #b794f6;
            --accent-blue: #63b3ed;
            --accent-green: #68d391;
            --accent-orange: #f6ad55;
            --accent-red: #fc8181;
            --accent-yellow: #fbd38d;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(183, 148, 246, 0.1), rgba(99, 179, 237, 0.1));
            border-radius: 20px;
            border: 2px solid var(--accent-purple);
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2em;
        }

        .program-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid var(--accent-purple);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .program-title {
            font-size: 2.2em;
            color: var(--accent-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .task-box {
            background: rgba(104, 211, 145, 0.1);
            border-left: 5px solid var(--accent-green);
            padding: 25px;
            margin: 30px 0;
            border-radius: 10px;
        }

        .task-box h3 {
            color: var(--accent-green);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .task-box ul {
            margin-left: 25px;
            color: var(--text-secondary);
        }

        .task-box li {
            margin: 8px 0;
        }

        .code-block {
            margin: 30px 0;
        }

        .code-block h4 {
            color: var(--accent-orange);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        pre {
            background: #1e1e1e !important;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            border: 1px solid var(--accent-purple);
        }

        code {
            font-family: 'Courier New', Monaco, monospace;
            font-size: 0.95em;
        }

        .highlight-box {
            background: rgba(99, 179, 237, 0.1);
            border: 2px solid var(--accent-blue);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .highlight-box h5 {
            color: var(--accent-blue);
            margin-bottom: 12px;
        }

        .explanation {
            background: rgba(183, 148, 246, 0.05);
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .explanation h4 {
            color: var(--accent-purple);
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .explanation h5 {
            color: var(--accent-orange);
            font-size: 1.3em;
            margin: 25px 0 15px 0;
        }

        .explanation p {
            color: var(--text-secondary);
            margin: 12px 0;
            line-height: 1.8;
        }

        .explanation strong {
            color: var(--accent-blue);
        }

        .explanation ul, .explanation ol {
            margin: 15px 0 15px 25px;
        }

        .explanation li {
            color: var(--text-secondary);
            margin: 8px 0;
        }

        .code-snippet {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: var(--accent-green);
            margin: 15px 0;
            border-left: 4px solid var(--accent-purple);
            overflow-x: auto;
        }

        .warning-box {
            background: rgba(252, 129, 129, 0.1);
            border: 2px solid var(--accent-red);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .warning-box h5 {
            color: var(--accent-red);
            margin-bottom: 12px;
        }

        .inline-code {
            background: rgba(183, 148, 246, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent-blue);
            font-size: 0.9em;
        }

        .diagram {
            text-align: center;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 10px;
            margin: 20px 0;
            color: var(--accent-green);
            font-family: 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.8;
        }

        .flow-box {
            background: rgba(251, 211, 141, 0.1);
            border: 2px solid var(--accent-yellow);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .flow-box h5 {
            color: var(--accent-yellow);
            margin-bottom: 12px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .program-title {
                font-size: 1.8em;
            }

            .container {
                padding: 20px 10px;
            }

            .program-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ“š SPO Vaja 9: TCP StreÅ¾nik in Odjemalec</h1>
        <p>OmreÅ¾no programiranje z vtiÄnicami (sockets) - kalkulator preko TCP</p>
    </div>

    <!-- OVERVIEW -->
    <div class="program-section">
        <div class="program-title">ğŸ¯ Pregled naloge</div>

        <div class="task-box">
            <h3>Arhitektura sistema</h3>
            <p>Sistem sestavljata dva programa, ki komunicirata preko TCP protokola:</p>
            <ul>
                <li><strong>STREÅ½NIK (server.c)</strong> â†’ sprejema povezave in raÄuna rezultate matematiÄnih operacij</li>
                <li><strong>ODJEMALEC (client.c)</strong> â†’ poÅ¡ilja raÄunske operacije in prejema rezultate</li>
            </ul>
        </div>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ODJEMALEC      â”‚                    â”‚    STREÅ½NIK      â”‚
â”‚   (client.c)     â”‚                    â”‚    (server.c)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                       â”‚
         â”‚   1. Povezava (TCP socket)           â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                       â”‚
         â”‚   2. PoÅ¡lje izraz "3.5 * 2"          â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                       â”‚
         â”‚                                       â”‚ 3. RazÄleni (sscanf)
         â”‚                                       â”‚ 4. IzraÄuna rezultat
         â”‚                                       â”‚
         â”‚   5. Vrne "Rezultat: 7.000000"       â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                                       â”‚
         â”‚   6. PoÅ¡lje nov izraz ali zapre      â”‚
         â”‚                                       â”‚
        </div>

        <div class="highlight-box">
            <h5>ğŸ”‘ KljuÄne znaÄilnosti</h5>
            <ul>
                <li><strong>TCP protokol</strong>: Zanesljiva, povezavno orientirana komunikacija</li>
                <li><strong>VtiÄnice (sockets)</strong>: Programski vmesnik za omreÅ¾no komunikacijo</li>
                <li><strong>Podprti operatorji</strong>: + (seÅ¡tevanje), - (odÅ¡tevanje), * (mnoÅ¾enje), / (deljenje)</li>
                <li><strong>Decimalna Å¡tevila</strong>: Podpora za raÄunanje z double (npr. 1.2 + 3.4)</li>
                <li><strong>NeskonÄna zanka</strong>: StreÅ¾nik sprejema veÄ povezav zaporedoma</li>
                <li><strong>Parametri</strong>: Port (streÅ¾nik) ali IP in port (odjemalec) preko ukazne vrstice</li>
            </ul>
        </div>
    </div>
    <!-- SERVER -->
    <div class="program-section">
        <div class="program-title">ğŸ–¥ï¸ server.c - TCP StreÅ¾nik</div>

        <div class="task-box">
            <h3>ğŸ¯ Naloga streÅ¾nika</h3>
            <ul>
                <li>Ustvari vtiÄnico (socket) in jo poveÅ¾e (bind) na doloÄen port</li>
                <li>PosluÅ¡a (listen) za dohodne povezave</li>
                <li>V neskonÄni zanki sprejema (accept) nove odjemalce</li>
                <li>Prebira izraze, jih razÄleni s sscanf</li>
                <li>IzraÄuna rezultat in ga poÅ¡lje nazaj</li>
                <li>Podpira decimalna Å¡tevila (double)</li>
            </ul>
        </div>

        <div class="code-block">
            <h4>Celotna izvorna koda:</h4>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;netinet/in.h&gt;

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, "Uporaba: %s &lt;port&gt;\n", argv[0]);
        return 1;
    }

    int port = atoi(argv[1]);

    int server_fd = socket(AF_INET, SOCK_STREAM, 0);
    if (server_fd < 0) {
        perror("socket");
        return 1;
    }

    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_addr.s_addr = INADDR_ANY;
    addr.sin_port = htons(port);

    if (bind(server_fd, (struct sockaddr*)&addr, sizeof(addr)) < 0) {
        perror("bind");
        return 1;
    }

    if (listen(server_fd, 5) < 0) {
        perror("listen");
        return 1;
    }

    printf("StreÅ¾nik posluÅ¡a na portu %d...\n", port);

    while (1) {
        int client_fd = accept(server_fd, NULL, NULL);
        if (client_fd < 0) {
            perror("accept");
            continue;
        }
        printf("Povezan odjemalec.\n");

        char buffer[256];
        int n;

        while ((n = read(client_fd, buffer, sizeof(buffer)-1)) > 0) {
            buffer[n] = '\0';
            printf("Prejel: %s", buffer);

            double a, b, result = 0.0;
            char op;

            if (sscanf(buffer, "%lf %c %lf", &a, &op, &b) != 3) {
                char *err = "Napaka pri razÄlenjevanju izraza.\n";
                write(client_fd, err, strlen(err));
                continue;
            }

            switch (op) {
                case '+': result = a + b; break;
                case '-': result = a - b; break;
                case '*': result = a * b; break;
                case '/': 
                    if (b == 0) {
                        char *err = "Napaka: deljenje z 0.\n";
                        write(client_fd, err, strlen(err));
                        continue;
                    }
                    result = a / b;
                    break;
                default:
                    {
                        char *err = "Neznan operator.\n";
                        write(client_fd, err, strlen(err));
                        continue;
                    }
            }

            char out[256];
            snprintf(out, sizeof(out), "Rezultat: %.6f\n", result);
            write(client_fd, out, strlen(out));
        }

        close(client_fd);
        printf("Odjemalec prekinil povezavo.\n");
    }

    close(server_fd);
    return 0;
}
</code></pre>
        </div>
        <div class="explanation">
            <h4>ğŸ” Podrobna razlaga - Vrstica za vrstico</h4>

            <h5>ğŸ“¦ VkljuÄene knjiÅ¾nice</h5>
            <div class="code-snippet">#include &lt;stdio.h&gt;      // printf, perror, fprintf
#include &lt;stdlib.h&gt;     // atoi, exit
#include &lt;string.h&gt;     // strlen, strcpy
#include &lt;unistd.h&gt;     // read, write, close
#include &lt;netinet/in.h&gt; // sockaddr_in, htons, INADDR_ANY</div>
            <p>Te knjiÅ¾nice so potrebne za delo z vhodno/izhodnimi operacijami, pretvarjanje nizov, omreÅ¾ne operacije in upravljanje vtiÄnic.</p>

            <h5>ğŸš€ Glavna funkcija - main()</h5>
            <div class="code-snippet">int main(int argc, char *argv[]) {</div>
            <p><strong>argc</strong> je Å¡tevilo argumentov ukazne vrstice, <strong>argv</strong> je polje kazalcev na argumente.</p>

            <h5>âœ… Preverjanje argumentov</h5>
            <div class="code-snippet">    if (argc != 2) {
        fprintf(stderr, "Uporaba: %s &lt;port&gt;\n", argv[0]);
        return 1;
    }</div>
            <p>StreÅ¾nik zahteva natanko 1 argument (poleg imena programa): Å¡tevilko porta.</p>
            <ul>
                <li><strong>argc != 2</strong>: Program ime + 1 argument = 2 skupaj</li>
                <li><strong>fprintf(stderr, ...)</strong>: IzpiÅ¡e sporoÄilo o napaki na standardni izhod za napake</li>
                <li><strong>argv[0]</strong>: Ime programa</li>
                <li><strong>return 1</strong>: Vrne kodo napake (0 = uspeh, 1 = napaka)</li>
            </ul>

            <h5>ğŸ”¢ Pretvorba porta</h5>
            <div class="code-snippet">    int port = atoi(argv[1]);</div>
            <p><strong>atoi</strong> (ASCII to Integer) pretvori niz (string) v celo Å¡tevilo. <span class="inline-code">argv[1]</span> je prvi argument po imenu programa - Å¡tevilka porta kot niz (npr. "8080").</p>

            <h5>ğŸ”Œ Ustvarjanje vtiÄnice</h5>
            <div class="code-snippet">    int server_fd = socket(AF_INET, SOCK_STREAM, 0);</div>
            <p><strong>socket()</strong> ustvari novo vtiÄnico (socket) - konÄno toÄko za komunikacijo:</p>
            <ul>
                <li><strong>AF_INET</strong>: Address Family = Internet (IPv4 protokol)</li>
                <li><strong>SOCK_STREAM</strong>: TCP vtiÄnica (zanesljiv, povezavno orientiran tok podatkov)</li>
                <li><strong>0</strong>: Privzeti protokol za TCP (lahko bi bil tudi IPPROTO_TCP)</li>
                <li><strong>Vrne</strong>: Deskriptor datoteke (file descriptor) za vtiÄnico ali -1 ob napaki</li>
            </ul>

            <div class="code-snippet">    if (server_fd < 0) {
        perror("socket");
        return 1;
    }</div>
            <p>Preverjanje napake. <strong>perror("socket")</strong> izpiÅ¡e sistemsko sporoÄilo o napaki s predpono "socket".</p>

            <h5>ğŸ“ Nastavitev naslova</h5>
            <div class="code-snippet">    struct sockaddr_in addr;</div>
            <p><strong>sockaddr_in</strong> je struktura za IPv4 naslove. Definirana v <span class="inline-code">&lt;netinet/in.h&gt;</span>.</p>

            <div class="code-snippet">    addr.sin_family = AF_INET;</div>
            <p><strong>sin_family</strong>: DruÅ¾ina naslovov - nastavljeno na AF_INET (IPv4).</p>

            <div class="code-snippet">    addr.sin_addr.s_addr = INADDR_ANY;</div>
            <p><strong>sin_addr.s_addr</strong>: IP naslov na katerem bo streÅ¾nik posluÅ¡al:</p>
            <ul>
                <li><strong>INADDR_ANY</strong>: Posebna vrednost (0.0.0.0) = sprejemaj na vseh omreÅ¾nih vmesnikih</li>
                <li>To pomeni, da bo streÅ¾nik dostopen preko kateregakoli IP naslova raÄunalnika</li>
            </ul>

            <div class="code-snippet">    addr.sin_port = htons(port);</div>
            <p><strong>sin_port</strong>: Å tevilka porta. <strong>htons</strong> (Host TO Network Short) pretvori port iz lokalnega vrstnega reda bajtov v omreÅ¾ni vrstni red (big-endian). To je potrebno zaradi razlik v arhitekturah.</p>

            <h5>ğŸ”— Povezava vtiÄnice na naslov (bind)</h5>
            <div class="code-snippet">    if (bind(server_fd, (struct sockaddr*)&addr, sizeof(addr)) < 0) {
        perror("bind");
        return 1;
    }</div>
            <p><strong>bind()</strong> poveÅ¾e vtiÄnico na doloÄen naslov in port:</p>
            <ul>
                <li><strong>server_fd</strong>: Deskriptor vtiÄnice</li>
                <li><strong>(struct sockaddr*)&addr</strong>: Kazalec na strukturo naslova, pretvorten v generiÄni tip sockaddr</li>
                <li><strong>sizeof(addr)</strong>: Velikost strukture naslova</li>
                <li><strong>Vrne</strong>: 0 ob uspehu, -1 ob napaki</li>
            </ul>
            <p>Po uspeÅ¡nem bind() je vtiÄnica "vezana" na port in lahko sprejema povezave.</p>

            <h5>ğŸ‘‚ PosluÅ¡anje za povezave</h5>
            <div class="code-snippet">    if (listen(server_fd, 5) < 0) {
        perror("listen");
        return 1;
    }</div>
            <p><strong>listen()</strong> nastavi vtiÄnico v naÄin posluÅ¡anja:</p>
            <ul>
                <li><strong>server_fd</strong>: VtiÄnica, ki bo posluÅ¡ala</li>
                <li><strong>5</strong>: Backlog - maksimalno Å¡tevilo ÄakajoÄih povezav v vrsti (preden jih accept() sprejme)</li>
                <li>Po klicu listen() lahko odjemalci zaÄnejo vzpostavljati povezave</li>
            </ul>

            <div class="code-snippet">    printf("StreÅ¾nik posluÅ¡a na portu %d...\n", port);</div>
            <p>Informativno sporoÄilo, da je streÅ¾nik pripravljen sprejemati povezave.</p>

            <h5>ğŸ”„ NeskonÄna zanka - sprejemanje odjemalcev</h5>
            <div class="code-snippet">    while (1) {</div>
            <p>NeskonÄna zanka - streÅ¾nik bo deloval, dokler ga ne ustavimo (Ctrl+C).</p>

            <div class="code-snippet">        int client_fd = accept(server_fd, NULL, NULL);</div>
            <p><strong>accept()</strong> Äaka na dohodno povezavo in jo sprejme:</p>
            <ul>
                <li><strong>server_fd</strong>: VtiÄnica, ki posluÅ¡a</li>
                <li><strong>NULL, NULL</strong>: Parametra za naslov odjemalca (ne potrebujemo te informacije)</li>
                <li><strong>Blokira</strong>: accept() se ustavi in Äaka, dokler se odjemalec ne poveÅ¾e</li>
                <li><strong>Vrne</strong>: Nov deskriptor vtiÄnice za komunikacijo s tem specifiÄnim odjemalcem</li>
            </ul>

            <div class="code-snippet">        if (client_fd < 0) {
            perror("accept");
            continue;
        }</div>
            <p>ÄŒe accept() ne uspe, izpiÅ¡emo napako in nadaljujemo z zanko (poskusimo sprejeti naslednjega odjemalca).</p>

            <div class="code-snippet">        printf("Povezan odjemalec.\n");</div>
            <p>Informativno sporoÄilo o novi povezavi.</p>
            <h5>ğŸ“¨ Branje in obdelava zahtevkov</h5>
            <div class="code-snippet">        char buffer[256];
        int n;</div>
            <p>Deklaracija medpomnilnika (buffer) za prejem podatkov in spremenljivke n za Å¡tevilo prebranih bajtov.</p>

            <div class="code-snippet">        while ((n = read(client_fd, buffer, sizeof(buffer)-1)) > 0) {</div>
            <p><strong>read()</strong> prebere podatke iz vtiÄnice:</p>
            <ul>
                <li><strong>client_fd</strong>: VtiÄnica odjemalca</li>
                <li><strong>buffer</strong>: Kam shranimo podatke</li>
                <li><strong>sizeof(buffer)-1</strong>: Maksimalno 255 bajtov (pustimo prostor za '\0')</li>
                <li><strong>Vrne</strong>: Å tevilo prebranih bajtov, 0 Äe je odjemalec zaprl povezavo, -1 ob napaki</li>
                <li><strong>Pogoj > 0</strong>: Zanka deluje, dokler prejemamo podatke</li>
            </ul>

            <div class="code-snippet">            buffer[n] = '\0';</div>
            <p>Dodamo niÄelni terminator na konec prebranega niza, da ga lahko uporabljamo kot obiÄajen C string.</p>

            <div class="code-snippet">            printf("Prejel: %s", buffer);</div>
            <p>Debug izpis - prikaÅ¾emo, kaj je streÅ¾nik prejel od odjemalca.</p>

            <h5>ğŸ§® RazÄlenjevanje izraza</h5>
            <div class="code-snippet">            double a, b, result = 0.0;
            char op;</div>
            <p>Deklaracija spremenljivk:</p>
            <ul>
                <li><strong>a, b</strong>: Operanda (Å¡tevili) - tip double za decimalna Å¡tevila</li>
                <li><strong>result</strong>: Rezultat operacije, inicializiran na 0.0</li>
                <li><strong>op</strong>: Operator (+, -, *, /)</li>
            </ul>

            <div class="code-snippet">            if (sscanf(buffer, "%lf %c %lf", &a, &op, &b) != 3) {
                char *err = "Napaka pri razÄlenjevanju izraza.\n";
                write(client_fd, err, strlen(err));
                continue;
            }</div>
            <p><strong>sscanf()</strong> prebere formatirane podatke iz niza:</p>
            <ul>
                <li><strong>buffer</strong>: Vhodni niz (npr. "3.5 * 2")</li>
                <li><strong>"%lf %c %lf"</strong>: Format - double, presledek, znak, presledek, double</li>
                <li><strong>&a, &op, &b</strong>: Kazalci na spremenljivke, kjer shranimo prebrane vrednosti</li>
                <li><strong>Vrne</strong>: Å tevilo uspeÅ¡no prebranih elementov (priÄakujemo 3)</li>
                <li>ÄŒe razÄlenjevanje ne uspe (npr. napaÄen format), poÅ¡ljemo sporoÄilo o napaki in nadaljujemo</li>
            </ul>

            <h5>ğŸ”¢ RaÄunanje rezultata</h5>
            <div class="code-snippet">            switch (op) {
                case '+': result = a + b; break;</div>
            <p><strong>switch</strong> stavek preverja vrednost operatorja <span class="inline-code">op</span>. ÄŒe je '+', seÅ¡tejemo a in b.</p>

            <div class="code-snippet">                case '-': result = a - b; break;</div>
            <p>ÄŒe je operator '-', odÅ¡tejemo b od a.</p>

            <div class="code-snippet">                case '*': result = a * b; break;</div>
            <p>ÄŒe je operator '*', mnoÅ¾imo a in b.</p>

            <div class="code-snippet">                case '/': 
                    if (b == 0) {
                        char *err = "Napaka: deljenje z 0.\n";
                        write(client_fd, err, strlen(err));
                        continue;
                    }
                    result = a / b;
                    break;</div>
            <p>ÄŒe je operator '/', najprej preverimo deljenje z 0:</p>
            <ul>
                <li>ÄŒe je <strong>b == 0</strong>, poÅ¡ljemo sporoÄilo o napaki in preskoÄimo to iteracijo</li>
                <li>Sicer delimo a z b</li>
                <li>To je pomembna varnostna preverka!</li>
            </ul>

            <div class="code-snippet">                default:
                    {
                        char *err = "Neznan operator.\n";
                        write(client_fd, err, strlen(err));
                        continue;
                    }
            }</div>
            <p><strong>default</strong>: ÄŒe operator ni noben od podprtih (+, -, *, /), poÅ¡ljemo sporoÄilo o napaki in nadaljujemo.</p>

            <h5>ğŸ“¤ PoÅ¡iljanje rezultata</h5>
            <div class="code-snippet">            char out[256];
            snprintf(out, sizeof(out), "Rezultat: %.6f\n", result);</div>
            <p><strong>snprintf()</strong> formatira niz v medpomnilnik:</p>
            <ul>
                <li><strong>out</strong>: Ciljni medpomnilnik</li>
                <li><strong>sizeof(out)</strong>: Maksimalna velikost (prepreÄuje buffer overflow)</li>
                <li><strong>"Rezultat: %.6f\n"</strong>: Format niza - izpiÅ¡e rezultat s 6 decimalkami</li>
                <li><strong>result</strong>: Vrednost, ki jo vstavimo</li>
            </ul>

            <div class="code-snippet">            write(client_fd, out, strlen(out));</div>
            <p><strong>write()</strong> poÅ¡lje podatke preko vtiÄnice:</p>
            <ul>
                <li><strong>client_fd</strong>: VtiÄnica odjemalca</li>
                <li><strong>out</strong>: Podatki za poÅ¡iljanje</li>
                <li><strong>strlen(out)</strong>: DolÅ¾ina niza</li>
            </ul>

            <div class="code-snippet">        }</div>
            <p>Konec notranje while zanke - nadaljujemo z branjem naslednjih zahtevkov od istega odjemalca.</p>

            <h5>ğŸ”š Zapiranje povezave z odjemalcem</h5>
            <div class="code-snippet">        close(client_fd);
        printf("Odjemalec prekinil povezavo.\n");</div>
            <p><strong>close()</strong> zapre vtiÄnico odjemalca. To se zgodi, ko odjemalec zapre povezavo ali Äe read() vrne <= 0.</p>

            <div class="code-snippet">    }</div>
            <p>Konec zunanje while(1) zanke - vrnemo se na accept() in Äakamo na naslednjega odjemalca.</p>

            <h5>ğŸ›‘ ÄŒiÅ¡Äenje (nikoli ne doseÅ¾e)</h5>
            <div class="code-snippet">    close(server_fd);
    return 0;
}</div>
            <p>Ta koda se ne izvede, ker je while(1) neskonÄna zanka. ÄŒe bi Å¾eleli elegantno zaustavitev, bi potrebovali signal handler.</p>

            <div class="warning-box">
                <h5>âš ï¸ Pomembno o vtiÄnicah</h5>
                <p>Vsak klic <span class="inline-code">accept()</span> ustvari NOVO vtiÄnico (<span class="inline-code">client_fd</span>) za komunikacijo s posameznim odjemalcem. Prvotna vtiÄnica (<span class="inline-code">server_fd</span>) ostane za posluÅ¡anje novih povezav.</p>
            </div>

            <div class="flow-box">
                <h5>â±ï¸ Potek delovanja streÅ¾nika</h5>
                <pre>1. Ustvari vtiÄnico (socket)
2. PoveÅ¾i na port (bind)
3. ZaÄni posluÅ¡ati (listen)
4. ZANKA:
   a. ÄŒakaj na odjemalca (accept) â† BLOKIRA
   b. Odjemalec se poveÅ¾e
   c. ZANKA:
      - Prejmi izraz (read)
      - RazÄleni (sscanf)
      - IzraÄunaj rezultat
      - PoÅ¡lji nazaj (write)
   d. Odjemalec zapre â†’ close(client_fd)
   e. Vrni se na korak 4a (Äakaj na naslednjega)</pre>
            </div>
        </div>
    </div>
    <!-- CLIENT -->
    <div class="program-section">
        <div class="program-title">ğŸ’» client.c - TCP Odjemalec</div>

        <div class="task-box">
            <h3>ğŸ¯ Naloga odjemalca</h3>
            <ul>
                <li>Ustvari vtiÄnico (socket)</li>
                <li>PoveÅ¾i se (connect) na streÅ¾nik na podanem IP naslovu in portu</li>
                <li>V zanki prebira izraze iz standardnega vhoda</li>
                <li>PoÅ¡ilja izraze streÅ¾niku</li>
                <li>Sprejema in izpisuje rezultate</li>
            </ul>
        </div>

        <div class="code-block">
            <h4>Celotna izvorna koda:</h4>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;arpa/inet.h&gt;

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Uporaba: %s &lt;ip&gt; &lt;port&gt;\n", argv[0]);
        return 1;
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);

    int sock = socket(AF_INET, SOCK_STREAM, 0);
    if (sock < 0) {
        perror("socket");
        return 1;
    }

    struct sockaddr_in server_addr;
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(port);
    inet_pton(AF_INET, ip, &server_addr.sin_addr);

    if (connect(sock, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {
        perror("connect");
        return 1;
    }

    printf("Povezano na %s:%d\n", ip, port);

    char buffer[256];
    char recvbuf[256];
    int n;

    while (1) {
        printf("Vnesi izraz (npr. 3.5 * 2): ");
        if (!fgets(buffer, sizeof(buffer), stdin))
            break;

        if (write(sock, buffer, strlen(buffer)) < 0) {
            perror("write");
            break;
        }

        n = read(sock, recvbuf, sizeof(recvbuf)-1);
        if (n <= 0) {
            printf("Povezava zaprta.\n");
            break;
        }

        recvbuf[n] = '\0';
        printf("%s", recvbuf);
    }

    close(sock);
    return 0;
}
</code></pre>
        </div>

        <div class="explanation">
            <h4>ğŸ” Podrobna razlaga - Vrstica za vrstico</h4>

            <h5>ğŸ“¦ VkljuÄene knjiÅ¾nice</h5>
            <div class="code-snippet">#include &lt;stdio.h&gt;      // printf, perror, fprintf, fgets
#include &lt;stdlib.h&gt;     // atoi, exit
#include &lt;string.h&gt;     // strlen
#include &lt;unistd.h&gt;     // read, write, close
#include &lt;arpa/inet.h&gt;  // inet_pton, htons, sockaddr_in</div>
            <p>KnjiÅ¾nica <strong>arpa/inet.h</strong> vsebuje funkcije za pretvarjanje IP naslovov.</p>

            <h5>ğŸš€ Glavna funkcija - main()</h5>
            <div class="code-snippet">int main(int argc, char *argv[]) {</div>
            <p>ZaÄetek glavne funkcije.</p>

            <h5>âœ… Preverjanje argumentov</h5>
            <div class="code-snippet">    if (argc != 3) {
        fprintf(stderr, "Uporaba: %s &lt;ip&gt; &lt;port&gt;\n", argv[0]);
        return 1;
    }</div>
            <p>Odjemalec zahteva natanko 2 argumenta:</p>
            <ul>
                <li><strong>argv[1]</strong>: IP naslov streÅ¾nika (npr. "127.0.0.1")</li>
                <li><strong>argv[2]</strong>: Å tevilka porta (npr. "8080")</li>
                <li><strong>argc != 3</strong>: Ime programa + 2 argumenta = 3 skupaj</li>
            </ul>

            <h5>ğŸ“ Shranjevanje parametrov</h5>
            <div class="code-snippet">    char *ip = argv[1];
    int port = atoi(argv[2]);</div>
            <p>Shranimo IP naslov kot niz in pretvorimo port iz niza v celo Å¡tevilo.</p>

            <h5>ğŸ”Œ Ustvarjanje vtiÄnice</h5>
            <div class="code-snippet">    int sock = socket(AF_INET, SOCK_STREAM, 0);
    if (sock < 0) {
        perror("socket");
        return 1;
    }</div>
            <p>Enako kot pri streÅ¾niku - ustvarimo TCP vtiÄnico. <strong>sock</strong> je deskriptor vtiÄnice odjemalca.</p>

            <h5>ğŸ“ Nastavitev naslova streÅ¾nika</h5>
            <div class="code-snippet">    struct sockaddr_in server_addr;</div>
            <p>Struktura za IPv4 naslov streÅ¾nika.</p>

            <div class="code-snippet">    server_addr.sin_family = AF_INET;</div>
            <p>Nastavi druÅ¾ino naslovov na IPv4.</p>

            <div class="code-snippet">    server_addr.sin_port = htons(port);</div>
            <p>Nastavi Å¡tevilko porta. <strong>htons</strong> pretvori v omreÅ¾ni vrstni red bajtov.</p>

            <div class="code-snippet">    inet_pton(AF_INET, ip, &server_addr.sin_addr);</div>
            <p><strong>inet_pton</strong> (Presentation TO Network) pretvori IP naslov iz teksta v binarno obliko:</p>
            <ul>
                <li><strong>AF_INET</strong>: IPv4 format</li>
                <li><strong>ip</strong>: Vhodni niz (npr. "127.0.0.1")</li>
                <li><strong>&server_addr.sin_addr</strong>: Kam shranimo rezultat</li>
                <li>Ta funkcija omogoÄa pisanje IP naslovov v berljivi obliki</li>
            </ul>

            <h5>ğŸ”— Povezava na streÅ¾nik</h5>
            <div class="code-snippet">    if (connect(sock, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {
        perror("connect");
        return 1;
    }</div>
            <p><strong>connect()</strong> vzpostavi povezavo s streÅ¾nikom:</p>
            <ul>
                <li><strong>sock</strong>: NaÅ¡a vtiÄnica</li>
                <li><strong>&server_addr</strong>: Naslov streÅ¾nika (IP + port)</li>
                <li><strong>sizeof(server_addr)</strong>: Velikost strukture</li>
                <li><strong>Blokira</strong>: ÄŒaka, dokler se povezava ne vzpostavi ali ne uspe</li>
                <li><strong>Vrne</strong>: 0 ob uspehu, -1 ob napaki</li>
            </ul>
            <p>Po uspeÅ¡nem connect() lahko zaÄnemo poÅ¡iljati in prejemati podatke.</p>

            <div class="code-snippet">    printf("Povezano na %s:%d\n", ip, port);</div>
            <p>Informativno sporoÄilo o uspeÅ¡ni povezavi.</p>

            <h5>ğŸ“ Priprava medpomnilnikov</h5>
            <div class="code-snippet">    char buffer[256];
    char recvbuf[256];
    int n;</div>
            <p>Deklaracija medpomnilnikov:</p>
            <ul>
                <li><strong>buffer</strong>: Za vhod od uporabnika (izrazi za raÄunanje)</li>
                <li><strong>recvbuf</strong>: Za prejete podatke od streÅ¾nika (rezultati)</li>
                <li><strong>n</strong>: Å tevilo prebranih bajtov</li>
            </ul>

            <h5>ğŸ”„ Glavna zanka - komunikacija s streÅ¾nikom</h5>
            <div class="code-snippet">    while (1) {</div>
            <p>NeskonÄna zanka - odjemalec deluje, dokler ga ne ustavimo ali ne zapre povezave.</p>

            <div class="code-snippet">        printf("Vnesi izraz (npr. 3.5 * 2): ");</div>
            <p>Poziv uporabniku za vnos izraza.</p>

            <div class="code-snippet">        if (!fgets(buffer, sizeof(buffer), stdin))
            break;</div>
            <p><strong>fgets()</strong> prebere vrstico iz standardnega vhoda:</p>
            <ul>
                <li><strong>buffer</strong>: Kam shranimo prebrano vrstico</li>
                <li><strong>sizeof(buffer)</strong>: Maksimalna dolÅ¾ina (255 znakov + '\0')</li>
                <li><strong>stdin</strong>: Standardni vhod (tipkovnica)</li>
                <li><strong>Vrne</strong>: Kazalec na buffer ob uspehu, NULL ob napaki ali EOF (Ctrl+D)</li>
                <li>ÄŒe vrne NULL, prekinemo zanko</li>
            </ul>

            <h5>ğŸ“¤ PoÅ¡iljanje izraza streÅ¾niku</h5>
            <div class="code-snippet">        if (write(sock, buffer, strlen(buffer)) < 0) {
            perror("write");
            break;
        }</div>
            <p><strong>write()</strong> poÅ¡lje izraz streÅ¾niku:</p>
            <ul>
                <li><strong>sock</strong>: NaÅ¡a vtiÄnica povezana s streÅ¾nikom</li>
                <li><strong>buffer</strong>: Podatki za poÅ¡iljanje (izraz)</li>
                <li><strong>strlen(buffer)</strong>: DolÅ¾ina niza</li>
                <li>ÄŒe write() ne uspe (vrne < 0), izpiÅ¡emo napako in prekinemo</li>
            </ul>

            <h5>ğŸ“¥ Prejemanje rezultata</h5>
            <div class="code-snippet">        n = read(sock, recvbuf, sizeof(recvbuf)-1);</div>
            <p><strong>read()</strong> prebere odgovor od streÅ¾nika:</p>
            <ul>
                <li><strong>sock</strong>: NaÅ¡a vtiÄnica</li>
                <li><strong>recvbuf</strong>: Medpomnilnik za prejete podatke</li>
                <li><strong>sizeof(recvbuf)-1</strong>: Maksimalno 255 bajtov</li>
                <li><strong>Vrne</strong>: Å tevilo prebranih bajtov, 0 Äe je streÅ¾nik zaprl, -1 ob napaki</li>
            </ul>

            <div class="code-snippet">        if (n <= 0) {
            printf("Povezava zaprta.\n");
            break;
        }</div>
            <p>ÄŒe read() vrne 0 ali negativno vrednost, je povezava prekinjena - izpiÅ¡emo sporoÄilo in zakljuÄimo.</p>

            <div class="code-snippet">        recvbuf[n] = '\0';</div>
            <p>Dodamo niÄelni terminator, da lahko recvbuf uporabimo kot C string.</p>

            <div class="code-snippet">        printf("%s", recvbuf);</div>
            <p>IzpiÅ¡emo prejeti rezultat od streÅ¾nika (npr. "Rezultat: 7.000000\n").</p>

            <div class="code-snippet">    }</div>
            <p>Konec while zanke - vrnemo se na zaÄetek in prosimo za nov izraz.</p>

            <h5>ğŸ”š Zapiranje povezave</h5>
            <div class="code-snippet">    close(sock);
    return 0;
}</div>
            <p><strong>close()</strong> zapre vtiÄnico. Program se konÄa.</p>

            <div class="highlight-box">
                <h5>ğŸ’¡ Razlika med streÅ¾nikom in odjemalcem</h5>
                <ul>
                    <li><strong>StreÅ¾nik</strong>: Uporablja <span class="inline-code">bind()</span>, <span class="inline-code">listen()</span> in <span class="inline-code">accept()</span></li>
                    <li><strong>Odjemalec</strong>: Uporablja samo <span class="inline-code">connect()</span></li>
                    <li>StreÅ¾nik Äaka (pasiven), odjemalec iniciira povezavo (aktiven)</li>
                </ul>
            </div>

            <div class="flow-box">
                <h5>â±ï¸ Potek delovanja odjemalca</h5>
                <pre>1. Ustvari vtiÄnico (socket)
2. PoveÅ¾i se na streÅ¾nik (connect)
3. ZANKA:
   a. Preberi izraz od uporabnika (fgets)
   b. PoÅ¡lji streÅ¾niku (write)
   c. Prejmi rezultat (read)
   d. IzpiÅ¡i rezultat (printf)
4. Zapri vtiÄnico (close)</pre>
            </div>
        </div>
    </div>
    <!-- KEY CONCEPTS -->
    <div class="program-section">
        <div class="program-title">ğŸ’¡ KljuÄni koncepti TCP programiranja</div>

        <div class="explanation">
            <h5>ğŸŒ Kaj je TCP?</h5>
            <p><strong>TCP (Transmission Control Protocol)</strong> je protokol transportne plasti, ki zagotavlja:</p>
            <ul>
                <li><strong>Zanesljivost</strong>: Podatki prispejo v celoti in brez napak</li>
                <li><strong>Vrstni red</strong>: Paketi prispejo v enakem vrstnem redu kot so bili poslani</li>
                <li><strong>Povezavno orientiranost</strong>: Pred komunikacijo se vzpostavi povezava</li>
                <li><strong>Nadzor pretoka</strong>: PrepreÄuje preobremenitev prejemnika</li>
            </ul>

            <h5>ğŸ”Œ Kaj je vtiÄnica (socket)?</h5>
            <p>VtiÄnica je programski vmesnik za omreÅ¾no komunikacijo. Deluje podobno kot datoteka:</p>
            <ul>
                <li>Ustvarimo jo s <span class="inline-code">socket()</span></li>
                <li>PiÅ¡emo z <span class="inline-code">write()</span></li>
                <li>Beremo z <span class="inline-code">read()</span></li>
                <li>Zapremo jo s <span class="inline-code">close()</span></li>
            </ul>

            <h5>ğŸ“Š Struktura sockaddr_in</h5>
            <div class="code-snippet">struct sockaddr_in {
    short sin_family;        // DruÅ¾ina naslovov (AF_INET)
    unsigned short sin_port; // Å tevilka porta (v omreÅ¾nem vrstnem redu)
    struct in_addr sin_addr; // IP naslov
    char sin_zero[8];        // Padding
};</div>

            <h5>ğŸ”„ Vrstni red bajtov</h5>
            <p>RazliÄni raÄunalniki shranjujejo veÄbajtna Å¡tevila razliÄno:</p>
            <ul>
                <li><strong>Little-endian</strong>: Najmanj pomemben bajt prvi (veÄina osebnih raÄunalnikov)</li>
                <li><strong>Big-endian</strong>: Najbolj pomemben bajt prvi (omreÅ¾ni standard)</li>
                <li><strong>htons/htonl</strong>: Host TO Network (pretvori v big-endian)</li>
                <li><strong>ntohs/ntohl</strong>: Network TO Host (pretvori iz big-endian)</li>
            </ul>

            <h5>ğŸ¯ Formati za sscanf in printf</h5>
            <div class="code-snippet">%d    - int (celo Å¡tevilo)
%f    - float (decimalno Å¡tevilo enojne natanÄnosti)
%lf   - double (decimalno Å¡tevilo dvojne natanÄnosti)
%c    - char (en znak)
%s    - string (niz)
%.6f  - float/double s 6 decimalkami</div>

            <h5>âš ï¸ Pogoste napake</h5>
            <div class="warning-box">
                <ul>
                    <li><strong>Pozabljen htons/htonl</strong>: Port ali IP v napaÄnem vrstnem redu</li>
                    <li><strong>Pozabljen '\0' terminator</strong>: Buffer overflow ali nepravilni nizi</li>
                    <li><strong>Ne preverjanje povratnih vrednosti</strong>: Napake ostanejo neopaÅ¾ene</li>
                    <li><strong>Deljenje z 0</strong>: Lahko povzroÄi crash programa</li>
                    <li><strong>Buffer overflow</strong>: Uporaba strcpy namesto snprintf</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- USAGE EXAMPLES -->
    <div class="program-section">
        <div class="program-title">ğŸš€ Primeri uporabe</div>

        <div class="highlight-box">
            <h5>ï¿½ï¿½ Prevajanje programov</h5>
            <div class="code-snippet">gcc server.c -o server
gcc client.c -o client</div>
        </div>

        <div class="highlight-box">
            <h5>â–¶ï¸ Zagon streÅ¾nika</h5>
            <div class="code-snippet">./server 8080</div>
            <p>StreÅ¾nik se zaÅ¾ene in posluÅ¡a na portu 8080.</p>
        </div>

        <div class="highlight-box">
            <h5>â–¶ï¸ Zagon odjemalca</h5>
            <div class="code-snippet">./client 127.0.0.1 8080</div>
            <p>Odjemalec se poveÅ¾e na streÅ¾nik na lokalnem raÄunalniku (127.0.0.1) na portu 8080.</p>
        </div>

        <div class="highlight-box">
            <h5>ğŸ“ Primeri izrazov</h5>
            <div class="code-snippet">Vnesi izraz (npr. 3.5 * 2): 5 + 3
Rezultat: 8.000000

Vnesi izraz (npr. 3.5 * 2): 10.5 - 2.3
Rezultat: 8.200000

Vnesi izraz (npr. 3.5 * 2): 4.5 * 2
Rezultat: 9.000000

Vnesi izraz (npr. 3.5 * 2): 10 / 4
Rezultat: 2.500000

Vnesi izraz (npr. 3.5 * 2): 1 / 0
Napaka: deljenje z 0.</div>
        </div>

        <div class="flow-box">
            <h5>ğŸ”„ Celoten potek komunikacije</h5>
            <pre>Terminal 1 (StreÅ¾nik):              Terminal 2 (Odjemalec):
$ ./server 8080                     
StreÅ¾nik posluÅ¡a na portu 8080...   $ ./client 127.0.0.1 8080
                                    Povezano na 127.0.0.1:8080
Povezan odjemalec.                  
                                    Vnesi izraz: 3.5 * 2
Prejel: 3.5 * 2                     Rezultat: 7.000000
                                    
                                    Vnesi izraz: 10 + 5
Prejel: 10 + 5                      Rezultat: 15.000000
                                    
                                    Vnesi izraz: ^D (Ctrl+D)
Odjemalec prekinil povezavo.        Povezava zaprta.</pre>
        </div>
    </div>

</div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
</html>
