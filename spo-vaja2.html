<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPO Vaja 2 - Complete Explanations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-card: #151933;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --accent-purple: #b794f6;
            --accent-blue: #63b3ed;
            --accent-green: #68d391;
            --accent-orange: #f6ad55;
            --accent-red: #fc8181;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(183, 148, 246, 0.1), rgba(99, 179, 237, 0.1));
            border-radius: 20px;
            border: 2px solid var(--accent-purple);
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2em;
        }

        .program-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid var(--accent-purple);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .program-title {
            font-size: 2.2em;
            color: var(--accent-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .task-box {
            background: rgba(104, 211, 145, 0.1);
            border-left: 5px solid var(--accent-green);
            padding: 25px;
            margin: 30px 0;
            border-radius: 10px;
        }

        .task-box h3 {
            color: var(--accent-green);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .task-box ul {
            margin-left: 25px;
            color: var(--text-secondary);
        }

        .task-box li {
            margin-bottom: 10px;
            line-height: 1.8;
        }

        .code-block {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid var(--accent-purple);
            overflow-x: auto;
            position: relative;
        }

        .code-block h4 {
            color: var(--accent-purple);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .code-block pre {
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.6;
            overflow-x: auto;
            margin: 0;
        }

        .code-block pre code {
            font-family: 'Courier New', monospace;
        }

        .explanation {
            background: rgba(183, 148, 246, 0.1);
            border-left: 5px solid var(--accent-purple);
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .explanation h4 {
            color: var(--accent-purple);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .explanation h5 {
            color: var(--accent-orange);
            margin: 25px 0 15px 0;
            font-size: 1.3em;
        }

        .explanation p {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.9;
        }

        .explanation strong {
            color: var(--accent-orange);
        }

        .explanation ul {
            margin: 15px 0 15px 30px;
        }

        .explanation li {
            margin-bottom: 12px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .code-snippet {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #d4d4d4;
            border: 1px solid var(--accent-blue);
            overflow-x: auto;
        }

        .highlight-box {
            background: rgba(246, 173, 85, 0.1);
            border: 2px solid var(--accent-orange);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .highlight-box h5 {
            color: var(--accent-orange);
            margin-bottom: 12px;
        }

        .warning-box {
            background: rgba(252, 129, 129, 0.1);
            border: 2px solid var(--accent-red);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .warning-box h5 {
            color: var(--accent-red);
            margin-bottom: 12px;
        }

        .key-concepts {
            background: rgba(99, 179, 237, 0.1);
            border-left: 5px solid var(--accent-blue);
            padding: 25px;
            margin: 30px 0;
            border-radius: 10px;
        }

        .key-concepts h4 {
            color: var(--accent-blue);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .key-concepts ul {
            margin-left: 25px;
        }

        .key-concepts li {
            margin-bottom: 12px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .flow-diagram {
            background: rgba(104, 211, 145, 0.05);
            border: 2px dashed var(--accent-green);
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            padding: 15px;
            background: rgba(183, 148, 246, 0.05);
            border-radius: 8px;
        }

        .flow-number {
            background: var(--accent-green);
            color: var(--bg-primary);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .flow-content {
            flex: 1;
        }

        .permission-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #1e1e1e;
            border-radius: 10px;
            overflow: hidden;
        }

        .permission-table th,
        .permission-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(183, 148, 246, 0.2);
        }

        .permission-table th {
            background: rgba(183, 148, 246, 0.2);
            color: var(--accent-purple);
            font-weight: bold;
        }

        .permission-table td {
            color: var(--text-secondary);
        }

        .inline-code {
            background: rgba(183, 148, 246, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent-blue);
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .program-title {
                font-size: 1.8em;
            }

            .container {
                padding: 20px 10px;
            }

            .program-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìö SPO Vaja 2: Podrobna Razlaga</h1>
        <p>Metapodatki datotek, pravice in posebni biti - Ultra natanƒçna razƒçlenitev</p>
    </div>

    <!-- LSL.C PROGRAM -->
    <div class="program-section">
        <div class="program-title">üìÑ lsl.c - Program za izpis lastnosti datotek</div>

        <div class="task-box">
            <h3>üéØ Navodila naloge</h3>
            <ul>
                <li>Napi≈°ite poenostavljeno razliƒçico ukaza <span class="inline-code">ls -l</span></li>
                <li>Izpi≈°ite tip datoteke, pravice, ≈°tevilo trdih povezav, lastnika, velikost in ime datoteke</li>
                <li>Podprite posebne bite pravic (SUID, SGID, Sticky Bit)</li>
                <li>Uporabite sistemske klice za branje metapodatkov datoteke</li>
            </ul>
        </div>

        <div class="code-block">
            <h4>Celotna izvorna koda:</h4>
            <pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;pwd.h&gt;
#include &lt;grp.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;

int main(int argc, char *argv[]){
    struct stat info;
    struct passwd *pw;
    struct group *gr;

    if (argc != 2) {
        printf("Napaƒçna uporaba programa:");
        return -1;
    }

    if (lstat(argv[1], &info) == -1) {
        perror("Napaka pri branju dat.");
        return -1;
    }

    pw = getpwuid(info.st_uid);
    gr = getgrgid(info.st_gid);
    mode_t mode = info.st_mode;

    char perms[11];

    // File type
    if (S_ISREG(mode)) perms[0] = '-';
    else if(S_ISDIR(mode)) perms[0] = 'd';
    else if(S_ISLNK(mode)) perms[0] = 'l';
    else if(S_ISCHR(mode)) perms[0] = 'c';
    else if(S_ISBLK(mode)) perms[0] = 'b';
    else if(S_ISFIFO(mode)) perms[0] = 'p';
    else if(S_ISSOCK(mode)) perms[0] = 's';
    else perms[0] = '?';

    // User permissions
    perms[1] = (mode & S_IRUSR) ? 'r' : '-';
    perms[2] = (mode & S_IWUSR) ? 'w' : '-';
    perms[3] = (mode & S_IXUSR) ? 'x' : '-';

    // Group permissions
    perms[4] = (mode & S_IRGRP) ? 'r' : '-';
    perms[5] = (mode & S_IWGRP) ? 'w' : '-';
    perms[6] = (mode & S_IXGRP) ? 'x' : '-';

    // Other permissions
    perms[7] = (mode & S_IROTH) ? 'r' : '-';
    perms[8] = (mode & S_IWOTH) ? 'w' : '-';
    perms[9] = (mode & S_IXOTH) ? 'x' : '-';
    perms[10] = '\0';

    // Special permissions
    if(mode & S_ISUID) perms[3] = (perms[3] == 'x') ? 's' : 'S';
    if(mode & S_ISGID) perms[6] = (perms[6] == 'x') ? 's' : 'S';
    if(mode & S_ISVTX) perms[9] = (perms[9] == 'x') ? 't' : 'T';

    printf("%s", perms);
    printf(" %lu %s %ld %s\n", info.st_nlink,
           (pw != NULL ? pw->pw_name : "?"),
           info.st_size, argv[1]);

    return 0;
}</pre>
        </div>

        <div class="explanation">
            <h4>üîç Podrobna razlaga vrstico po vrstico</h4>

            <h5>üìö 1. Vkljuƒçevanje knji≈ænic - Zakaj jih potrebujemo?</h5>
            <div class="code-snippet">#include &lt;stdio.h&gt;
                #include &lt;stdlib.h&gt;
                #include &lt;sys/stat.h&gt;
                #include &lt;pwd.h&gt;
                #include &lt;grp.h&gt;
                #include &lt;unistd.h&gt;
                #include &lt;string.h&gt;</div>
            <p>Vsaka knji≈ænica slu≈æi doloƒçenemu namenu:</p>
            <ul>
                <li><strong>&lt;stdio.h&gt;</strong>: Za funkciji printf() in perror() (izpisovanje).</li>
                <li><strong>&lt;stdlib.h&gt;</strong>: Splo≈°ne utility funkcije (npr. exit, atoi).</li>
                <li><strong>&lt;sys/stat.h&gt;</strong>: GLAVNA KNJI≈ΩNICA TE VAJE! Vsebuje:
                    <ul>
                        <li><span class="inline-code">struct stat</span> - struktura z metapodatki datoteke.</li>
                        <li><span class="inline-code">S_ISREG, S_ISDIR</span> - makri za preverjanje tipa datoteke.</li>
                        <li><span class="inline-code">S_IRUSR, S_IWUSR</span> - konstante za pravice.</li>
                        <li><span class="inline-code">S_ISUID, S_ISGID</span> - posebni biti.</li>
                        <li><span class="inline-code">lstat()</span> - deklaracija sistemskega klica.</li>
                    </ul>
                </li>
                <li><strong>&lt;pwd.h&gt;</strong>: "Password" baza - vsebuje getpwuid() za pretvorbo UID (≈°tevilke) v uporabni≈°ko ime.</li>
                <li><strong>&lt;grp.h&gt;</strong>: "Group" baza - vsebuje getgrgid() za pretvorbo GID v ime skupine.</li>
                <li><strong>&lt;unistd.h&gt;</strong>: Standardne definicije za Unix (splo≈°ni sistemski klici).</li>
            </ul>

            <h5>üì¶ 2. Deklaracija pomembnih struktur</h5>
            <div class="code-snippet">struct stat info;
struct passwd *pw;
struct group *gr;</div>
            <p><strong>struct stat info</strong>: To je NAJPOMBEMBNEJ≈†A spremenljivka v tem programu!</p>
            <ul>
                <li>Vsebuje VSE metapodatke o datoteki.</li>
                <li>Kljuƒçna polja, ki jih uporabimo:
                    <ul>
                        <li><span class="inline-code">st_mode</span>: Tip datoteke + pravice (vse v enem 16-bitnem ≈°tevilu).</li>
                        <li><span class="inline-code">st_nlink</span>: ≈†tevilo trdih povezav.</li>
                        <li><span class="inline-code">st_uid</span>: ID uporabnika (lastnika).</li>
                        <li><span class="inline-code">st_gid</span>: ID skupine.</li>
                        <li><span class="inline-code">st_size</span>: Velikost datoteke v bajtih.</li>
                    </ul>
                </li>
            </ul>

            <p><strong>struct passwd *pw</strong>: Kazalec na vnos o uporabniku</p>
            <ul>
                <li>Vrne ga funkcija <span class="inline-code">getpwuid</span>.</li>
                <li>Vsebuje polje <span class="inline-code">pw_name</span> (uporabni≈°ko ime kot niz).</li>
            </ul>

            <p><strong>struct group *gr</strong>: Kazalec na vnos o skupini</p>
            <ul>
                <li>Za pridobivanje imena skupine iz GID-a.</li>
            </ul>

            <h5>üîç 3. Branje podatkov z lstat()</h5>
            <div class="code-snippet">if (lstat(argv[1], &info) == -1) {
    perror("Napaka pri branju dat.");
    return -1;
}</div>

            <div class="highlight-box">
                <h5>ü§î ZAKAJ lstat() in NE stat()?</h5>
                <p>To je KRITIƒåNA razlika!</p>
                <ul>
                    <li><strong>stat()</strong>: Sledi simbolnim povezavam.
                        <ul>
                            <li>ƒåe pokliƒçete stat() na bli≈ænjici (symlink), bo prebral podatke CILJNE datoteke.</li>
                            <li>Primer: bli≈ænjica ka≈æe na velik_film.mkv ‚Üí stat() vrne velikost filma.</li>
                        </ul>
                    </li>
                    <li><strong>lstat()</strong>: NE sledi simbolnim povezavam.
                        <ul>
                            <li>Prebere podatke o SAMEJ BLI≈ΩNJICI.</li>
                            <li>Primer: bli≈ænjica ‚Üí lstat() vrne tip 'l' in zelo majhno velikost (samo pot do cilja).</li>
                        </ul>
                    </li>
                    <li><strong>Zakaj tu lstat?</strong> Ker <span class="inline-code">ls -l</span> mora prikazati podatke o sami povezavi, ne pa o tistem, kamor ka≈æe!</li>
                </ul>
            </div>

            <p><strong>lstat(argv[1], &info)</strong> naredi naslednje:</p>
            <ul>
                <li>Vzame ime datoteke (<span class="inline-code">argv[1]</span>) in naslov na≈°e strukture (<span class="inline-code">&info</span>).</li>
                <li>Operacijski sistem napolni strukturo s podatki.</li>
                <li>Vrne -1 v primeru napake (datoteka ne obstaja, ni pravic za branje mape...).</li>
            </ul>

            <h5>üë§ 4. Pretvorba ID-jev v Imena</h5>
            <div class="code-snippet">pw = getpwuid(info.st_uid);
gr = getgrgid(info.st_gid);
mode_t mode = info.st_mode;</div>

            <p><strong>getpwuid(info.st_uid)</strong>:</p>
            <ul>
                <li>Vzame ≈°tevilko uporabnika (npr. 1000).</li>
                <li>Prei≈°ƒçe <span class="inline-code">/etc/passwd</span>.</li>
                <li>Vrne strukturo z imenom "student".</li>
            </ul>

            <p><strong>mode_t mode = info.st_mode</strong>:</p>
            <ul>
                <li>Da ne tipkamo vedno <span class="inline-code">info.st_mode</span>, si shranimo v spremenljivko.</li>
                <li>To ≈°tevilo vsebuje bite za tip datoteke IN bite za pravice.</li>
            </ul>

            <h5>üìÅ 5. Ugotavljanje tipa datoteke</h5>
            <div class="code-snippet">char perms[11];
if (S_ISREG(mode)) perms[0] = '-';
else if(S_ISDIR(mode)) perms[0] = 'd';
else if(S_ISLNK(mode)) perms[0] = 'l';
else if(S_ISCHR(mode)) perms[0] = 'c';
else if(S_ISBLK(mode)) perms[0] = 'b';
else if(S_ISFIFO(mode)) perms[0] = 'p';
else if(S_ISSOCK(mode)) perms[0] = 's';
else perms[0] = '?';</div>

            <p><strong>char perms[11]</strong>: Array for 10 characters + null terminator</p>
            <ul>
                <li>perms[0] = file type</li>
                <li>perms[1-9] = permissions (rwxrwxrwx)</li>
                <li>perms[10] = '\0' (null terminator for string)</li>
            </ul>

            <div class="highlight-box">
                <h5>üîç How S_IS* Macros Work</h5>
                <p>These macros check specific bits in the mode field:</p>
                <ul>
                    <li>They use bitwise AND with predefined masks</li>
                    <li>Example: <span class="inline-code">S_ISREG(mode)</span> checks if ((mode & 0170000) == 0100000)</li>
                    <li>The top 4 bits of mode determine file type</li>
                </ul>
            </div>

            <table class="permission-table">
                <thead>
                <tr>
                    <th>Makro</th>
                    <th>Znak</th>
                    <th>Pomen</th>
                </tr>
                </thead>
                <tbody>
                <tr><td>S_ISREG</td><td>-</td><td>Navadna datoteka (regular file)</td></tr>
                <tr><td>S_ISDIR</td><td>d</td><td>Imenik / Mapa (directory)</td></tr>
                <tr><td>S_ISLNK</td><td>l</td><td>Simbolna povezava (link)</td></tr>
                <tr><td>S_ISCHR</td><td>c</td><td>Znakovna naprava (char device - terminal)</td></tr>
                <tr><td>S_ISBLK</td><td>b</td><td>Bloƒçna naprava (block device - disk)</td></tr>
                <tr><td>S_ISFIFO</td><td>p</td><td>Imenik cevovod (pipe)</td></tr>
                <tr><td>S_ISSOCK</td><td>s</td><td>Vtiƒçnica (socket)</td></tr>
                </tbody>
            </table>

            <h5>üîê 6. Uprabni≈°ke pravice (User)</h5>
            <div class="code-snippet">perms[1] = (mode & S_IRUSR) ? 'r' : '-';
perms[2] = (mode & S_IWUSR) ? 'w' : '-';
perms[3] = (mode & S_IXUSR) ? 'x' : '-';</div>

            <div class="highlight-box">
                <h5>üéØ Razumevanje bitnega IN (&)</h5>
                <p><strong>Kako deluje (mode & S_IRUSR)?</strong></p>
                <ul>
                    <li><span class="inline-code">S_IRUSR</span> je konstanta, kjer je pri≈ægan samo bit za branje lastnika.</li>
                    <li><span class="inline-code">mode & S_IRUSR</span> "zakrije" vse ostale bite.</li>
                    <li>ƒåe je rezultat razliƒçen od 0, potem je bit pri≈ægan ‚Üí zapi≈°emo 'r'.</li>
                    <li>ƒåe je rezultat 0 ‚Üí zapi≈°emo '-'.</li>
                </ul>
            </div>

            <h5>üë• 7. Skupinske pravice (Group)</h5>
            <div class="code-snippet">perms[4] = (mode & S_IRGRP) ? 'r' : '-';
perms[5] = (mode & S_IWGRP) ? 'w' : '-';
perms[6] = (mode & S_IXGRP) ? 'x' : '-';</div>

            <p>Enaka logika, le druge konstante:</p>
            <ul>
                <li><strong>S_IRGRP</strong>: Skupina bere (Read)</li>
                <li><strong>S_IWGRP</strong>: Skupina pi≈°e (Write)</li>
                <li><strong>S_IXGRP</strong>: Skupina izvaja (Execute)</li>
            </ul>

            <h5>üåç 8. Pravice ostalih (Other)</h5>
            <div class="code-snippet">perms[7] = (mode & S_IROTH) ? 'r' : '-';
perms[8] = (mode & S_IWOTH) ? 'w' : '-';
perms[9] = (mode & S_IXOTH) ? 'x' : '-';
perms[10] = '\0';</div>

            <p>Enaka logika za "druge" uporabnike (vse, ki niso lastnik in niso v skupini):</p>
            <ul>
                <li><strong>S_IROTH</strong>: Druge berejo (Read)</li>
                <li><strong>S_IWOTH</strong>: Druge pi≈°ejo (Write)</li>
                <li><strong>S_IXOTH</strong>: Druge izvajajo (Execute)</li>
                <li><strong>perms[10] = '\0'</strong>: Null terminator, da naredimo veljaven C niz, ki ga printf lahko izpi≈°e.</li>
            </ul>

            <h5>‚≠ê 9. Posebni biti (Special Bits) - PAZI TU!</h5>
            <div class="code-snippet">if(mode & S_ISUID) perms[3] = (perms[3] == 'x') ? 's' : 'S';
if(mode & S_ISGID) perms[6] = (perms[6] == 'x') ? 's' : 'S';
if(mode & S_ISVTX) perms[9] = (perms[9] == 'x') ? 't' : 'T';</div>

            <p><strong>Kaj so ti biti?</strong></p>
            <ul>
                <li><strong>S_ISUID (Set UID)</strong> - Pozicija: tam kjer je 'x' za uporabnika.
                    <ul>
                        <li>ƒåe je nastavljen na programu: Program teƒçe s pravicami <strong>lastnika datoteke</strong>, ne tistega, ki ga je pognal.</li>
                        <li>Primer: <span class="inline-code">passwd</span> (mora imeti root pravice, da spremeni geslo).</li>
                        <li><strong>'s' vs 'S'</strong>:
                            <ul>
                                <li>'s' (mali): ƒåe je bil 'x' ≈æe prej pri≈ægan.</li>
                                <li>'S' (veliki): ƒåe 'x' ni bil pri≈ægan (datoteka je SUID, a je nihƒçe ne more pognati - ƒçudno stanje).</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>S_ISGID (Set GID)</strong> - Pozicija: tam kjer je 'x' za skupino.
                    <ul>
                        <li>Na datoteki: Teƒçe s pravicami skupine.</li>
                        <li>Na mapi: Nove datoteke v tej mapi podedujejo <strong>skupino mape</strong> (dobro za skupne projekte).</li>
                    </ul>
                </li>
                <li><strong>S_ISVTX (Sticky Bit)</strong> - Pozicija: tam kjer je 'x' za ostale.
                    <ul>
                        <li>Na mapi: <strong>Samo lastnik</strong> datoteke jo lahko izbri≈°e (tudi ƒçe imajo ostali write pravice na mapo).</li>
                        <li>Primer: <span class="inline-code">/tmp</span> (vsi pi≈°ejo, ampak ne more≈° brisati tujih datotek).</li>
                        <li>Oznaka 't' ali 'T'.</li>
                    </ul>
                </li>
            </ul>

            <h5>üìä 10. Izpis v printf</h5>
            <div class="code-snippet">printf(" %lu %s %ld %s\n", info.st_nlink, ...);</div>
            <ul>
                <li><strong>info.st_nlink</strong>: ≈†tevilo trdih povezav (hard links).</li>
                <li><strong>pw->pw_name</strong>: Ime uporabnika (preverimo NULL, ƒçe ID ne obstaja v sistemu).</li>
                <li><strong>info.st_size</strong>: Velikost v bajtih.</li>
            </ul>
        </div>
    </div>

    <!-- MOJCHMOD.C PROGRAM -->
    <div class="program-section">
        <div class="program-title">üõ†Ô∏è mojChmod.c - Lastna implementacija chmod</div>

        <div class="task-box">
            <h3>üéØ Navodila naloge</h3>
            <ul>
                <li>Napi≈°ite orodje za spreminjanje pravic.</li>
                <li>Podpora simbolnim ukazom: <span class="inline-code">u+s, u-s, g+s</span>.</li>
                <li>Podpora posebnemu ukazu: <span class="inline-code">a+rX</span>.</li>
                <li>Podpora klasiƒçnim osmi≈°kim (octal) ≈°tevilom (npr. 755, 644).</li>
            </ul>
        </div>

        <div class="code-block">
            <h4>Celotna izvorna koda:</h4>
            <pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include &lt;stdbool.h&gt;

void print_mode(mode_t mode) {
    char perms[11];

    // File Type Listing
    if (S_ISREG(mode)) perms[0] = '-';
    else if(S_ISDIR(mode)) perms[0] = 'd';
    // ... (rest of type checks similar to lsl.c) ...
    else perms[0] = '?';

    // User perm
    perms[1] = (mode & S_IRUSR) ? 'r' : '-';
    perms[2] = (mode & S_IWUSR) ? 'w' : '-';
    perms[3] = (mode & S_IXUSR) ? 'x' : '-';

    // Group perm
    perms[4] = (mode & S_IRGRP) ? 'r' : '-';
    perms[5] = (mode & S_IWGRP) ? 'w' : '-';
    perms[6] = (mode & S_IXGRP) ? 'x' : '-';

    // Other perm
    perms[7] = (mode & S_IROTH) ? 'r' : '-';
    perms[8] = (mode & S_IWOTH) ? 'w' : '-';
    perms[9] = (mode & S_IXOTH) ? 'x' : '-';
    perms[10] = '\0';

    // Special perm
    if(mode & S_ISUID) perms[3] = (perms[3] == 'x') ? 's' : 'S';
    if(mode & S_ISGID) perms[6] = (perms[6] == 'x') ? 's' : 'S';
    if(mode & S_ISVTX) perms[9] = (perms[9] == 'x') ? 't' : 'T';

    printf("Nova dovoljenja: %%s\n", perms);
}

int main(int argc, char *argv[]){
    if (argc != 3) {
        printf("Napaƒçna uporaba programa:");
        return -1;
    }

    char *mode_str = argv[1];
    char *filename = argv[2];
    struct stat info;
    bool check = true;

    // Read current info to get existing mode
    if (stat(filename, &info) == -1) {
        perror("Napaka pri branju dat.");
        return -1;
    }

    mode_t new_mode = info.st_mode;

    // Symbolic Logic
    if (strcmp(mode_str, "u+s") == 0) {
        new_mode |= S_ISUID;
    }
    else if (strcmp(mode_str, "u-s") == 0) {
        new_mode &= ~S_ISUID;
    }
    else if (strcmp(mode_str, "g+s") == 0) {
        new_mode |= S_ISGID;
    }
    else if (strcmp(mode_str, "a+rX") == 0) {
        // If owner has read, give everyone read
        if (info.st_mode & S_IRUSR) {
            new_mode |= S_IRGRP;
            new_mode |= S_IROTH;
        }
    }
    else {
        // Octal Logic
        long int mode_oct;
        char *endptr;
        mode_oct = strtol(mode_str, &endptr, 8);
        if(endptr != mode_str) {
            check = false; // We use direct chmod with octal value
            if (chmod (filename, mode_oct) < 0) {
                perror(argv[0]);
                exit(1);
            }
        }
        else { printf("napaka"); }
    }

    // Apply calculated symbolic mode
    if(check) chmod(filename, new_mode);

    // Verify
    stat(filename, &info);
    print_mode(info.st_mode);
    return 0;
}</pre>
        </div>

        <div class="explanation">
            <h4>üîç Razlaga logike in kode</h4>

            <h5>1. Preverjanje argumentov</h5>
            <div class="code-snippet">if (argc != 3) { printf("Napaƒçna uporaba..."); return -1; }</div>
            <p>Program zahteva toƒçno 2 argumenta (poleg imena programa): naƒçin (mod) in ime datoteke.</p>

            <h5>2. Branje trenutnega stanja</h5>
            <div class="code-snippet">stat(filename, &info);
mode_t new_mode = info.st_mode;</div>
            <p>Najprej moramo vedeti, kak≈°ne so trenutne pravice, da jih lahko spremenimo (npr. dodamo bit). Shranimo jih v <span class="inline-code">new_mode</span>, kjer bomo delali spremembe.</p>

            <h5>3. Simbolno spreminjanje - Logika IF stavkov</h5>

            <p><strong>Primer: u+s (Dodaj SUID bit)</strong></p>
            <div class="code-snippet">if (strcmp(mode_str, "u+s") == 0) {
    new_mode |= S_ISUID;
}</div>
            <p>Uporabimo <strong>bitni ALI (|=)</strong>. Ta operacija postavi bit na 1, ostale pusti pri miru. "Dodamo" pravico.</p>

            <p><strong>Primer: u-s (Odstrani SUID bit)</strong></p>
            <div class="code-snippet">else if (strcmp(mode_str, "u-s") == 0) {
    new_mode &= ~S_ISUID;
}</div>
            <p>Uporabimo <strong>bitni IN (&=)</strong> skupaj z <strong>negacijo (~)</strong>.
            <br>~S_ISUID naredi masko, kjer so vsi biti 1, razen SUID bita, ki je 0.
            <br>Ko naredimo AND, se vsi biti ohranijo, SUID bit pa se prisilno postavi na 0.</p>

            <p><strong>Primer: a+rX (Poseben pogoj)</strong></p>
            <div class="code-snippet">else if (strcmp(mode_str, "a+rX") == 0) {
    if (info.st_mode & S_IRUSR) {
        new_mode |= S_IRGRP;
        new_mode |= S_IROTH;
    }
}</div>
            <p>Ta ukaz pravi: "Vsem dodaj pravico branja (in izvajanja), ƒçe jo ima lastnik".
            <br>Preverimo <span class="inline-code">if (info.st_mode & S_IRUSR)</span> - ali lastnik ≈ΩE ima pravico branja?
            <br>ƒåe ja, potem z |= dodamo branje ≈°e skupini (GRP) in ostalim (OTH).</p>

            <h5>4. Branje osmi≈°kih (octal) ≈°tevil</h5>
            <div class="code-snippet">mode_oct = strtol(mode_str, &endptr, 8);</div>
            <p>ƒåe ni bil noben od zgornjih stringov, predvidevamo, da je uporabnik vpisal ≈°tevilko (npr. "755").</p>
            <ul>
                <li><strong>strtol</strong>: String to Long.</li>
                <li><strong>Baza 8</strong>: Ker so pravice v Linuxu osmi≈°ke.</li>
                <li><strong>endptr</strong>: Pove, kje se je branje ustavilo. ƒåe ka≈æe na zaƒçetek niza, pomeni, da v nizu ni bilo ≈°tevilke (napaka).</li>
                <li><strong>strtok</strong>: Pazite, strtok uniƒçi originalni niz. Tu uporabljamo strtol.</li>
            </ul>

            <h5>5. Sistemski klic chmod()</h5>
            <div class="code-snippet">chmod(filename, new_mode)</div>
            <p>To je tisti klic, ki dejansko spremeni zapis na disku (inode). Vse prej je bilo le raƒçunanje v pomnilniku.</p>
        </div>
    </div>

</div> <!-- End Container -->
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
</html>
